// jquery.repeater version 1.2.1
// https://github.com/DubFriend/jquery.repeater
// (MIT) 09-10-2016
// Brian Detering <BDeterin@gmail.com> (http://www.briandetering.net/)
!function(v){"use strict";var c,r,i,u,o,f,s,p,l,h,d,m,g,y,b,$,k,x,T,a,w=function(t){return t},C=function(t){return v.isArray(t)},V=function(t){return!C(t)&&t instanceof Object},E=function(t,e){return v.inArray(e,t)},j=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n,t)},q=function(t){return t[t.length-1]},A=function(){var t,n={};return j((t=arguments,Array.prototype.slice.call(t)),function(t){j(t,function(t,e){n[e]=t})}),n},O=function(t,e,n){return C(t)?(a=e,c=[],j(t,function(t,e,n){c.push(a(t,e,n))}),c):(i=e,r=n,u={},j(t,function(t,e,n){e=r?r(e,t):e,u[e]=i(t,e,n)}),u);var i,r,u,a,c},Q=function(t,n,i){return O(t,function(t,e){return t[n].apply(t,i||[])})};c=jQuery,r=function(t,i){var e,r,u,a=(r={},(e=e||{}).publish=function(t,e){j(r[t],function(t){t(e)})},e.subscribe=function(t,e){r[t]=r[t]||[],r[t].push(e)},e.unsubscribe=function(n){j(r,function(t){var e=E(t,n);-1!==e&&t.splice(e,1)})},e),n=t.$;return a.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},a.$=function(t){return t?n.find(t):n},a.disable=function(){a.$().prop("disabled",!0),a.publish("isEnabled",!1)},a.enable=function(){a.$().prop("disabled",!1),a.publish("isEnabled",!0)},i.equalTo=function(t,e){return t===e},i.publishChange=function(t,e){var n=a.get();i.equalTo(n,u)||a.publish("change",{e:t,domElement:e}),u=n},a},i=function(t,e){var n=r(t,e);return n.get=function(){return n.$().val()},n.set=function(t){n.$().val(t)},n.clear=function(){n.set("")},e.buildSetter=function(e){return function(t){e.call(n,t)}},n},u=function(t,e){t=C(t)?t:[t],e=C(e)?e:[e];var n=!0;return t.length!==e.length?n=!1:j(t,function(t){-1===E(e,t)&&(n=!1)}),n},o=function(t){var e={},n=i(t,e);return n.getType=function(){return"button"},n.$().on("change",function(t){e.publishChange(t,this)}),n},f=function(t){var e={},n=i(t,e);return n.getType=function(){return"checkbox"},n.get=function(){var t=[];return n.$().filter(":checked").each(function(){t.push(c(this).val())}),t},n.set=function(t){t=C(t)?t:[t],n.$().each(function(){c(this).prop("checked",!1)}),j(t,function(t){n.$().filter('[value="'+t+'"]').prop("checked",!0)})},e.equalTo=u,n.$().change(function(t){e.publishChange(t,this)}),n},s=function(t){var e=$(t,{});return e.getType=function(){return"email"},e},p=function(t){var e={},n=r(t,e);return n.getType=function(){return"file"},n.get=function(){return q(n.$().val().split("\\"))},n.clear=function(){this.$().each(function(){c(this).wrap("<form>").closest("form").get(0).reset(),c(this).unwrap()})},n.$().change(function(t){e.publishChange(t,this)}),n},l=function(t){var e={},n=i(t,e);return n.getType=function(){return"hidden"},n.$().change(function(t){e.publishChange(t,this)}),n},h=function(t){var e={},i=r(t,e);return i.getType=function(){return"file[multiple]"},i.get=function(){var t,e=i.$().get(0).files||[],n=[];for(t=0;t<(e.length||0);t+=1)n.push(e[t].name);return n},i.clear=function(){this.$().each(function(){c(this).wrap("<form>").closest("form").get(0).reset(),c(this).unwrap()})},i.$().change(function(t){e.publishChange(t,this)}),i},d=function(t){var e={},n=i(t,e);return n.getType=function(){return"select[multiple]"},n.get=function(){return n.$().val()||[]},n.set=function(t){n.$().val(""===t?[]:C(t)?t:[t])},e.equalTo=u,n.$().change(function(t){e.publishChange(t,this)}),n},m=function(t){var e=$(t,{});return e.getType=function(){return"password"},e},g=function(t){var e={},n=i(t,e);return n.getType=function(){return"radio"},n.get=function(){return n.$().filter(":checked").val()||null},n.set=function(t){t?n.$().filter('[value="'+t+'"]').prop("checked",!0):n.$().each(function(){c(this).prop("checked",!1)})},n.$().change(function(t){e.publishChange(t,this)}),n},y=function(t){var e={},n=i(t,e);return n.getType=function(){return"range"},n.$().change(function(t){e.publishChange(t,this)}),n},b=function(t){var e={},n=i(t,e);return n.getType=function(){return"select"},n.$().change(function(t){e.publishChange(t,this)}),n},$=function(t){var e={},n=i(t,e);return n.getType=function(){return"text"},n.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),n},k=function(t){var e={},n=i(t,e);return n.getType=function(){return"number"},n.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),n},x=function(t){var e={},n=i(t,e);return n.getType=function(){return"textarea"},n.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),n},T=function(t){var e=$(t,{});return e.getType=function(){return"url"},e},a=function(t){var r={},u=t.$,a=t.constructorOverride||{button:o,text:$,number:k,url:T,email:s,password:m,range:y,textarea:x,select:b,"select[multiple]":d,radio:g,checkbox:f,file:p,"file[multiple]":h,hidden:l},e=function(e,t){(V(t)?t:u.find(t)).each(function(){var t=c(this).attr("name");r[t]=a[e]({$:c(this)})})},n=function(e,t){var n=[],i=V(t)?t:u.find(t);V(t)?r[i.attr("name")]=a[e]({$:i}):(i.each(function(){-1===E(n,c(this).attr("name"))&&n.push(c(this).attr("name"))}),j(n,function(t){r[t]=a[e]({$:u.find('input[name="'+t+'"]')})}))};return u.is("input, select, textarea")?u.is('input[type="button"], button, input[type="submit"]')?e("button",u):u.is("textarea")?e("textarea",u):u.is('input[type="text"]')||u.is("input")&&!u.attr("type")?e("text",u):u.is('input[type="number"]')?e("number",u):u.is('input[type="password"]')?e("password",u):u.is('input[type="email"]')?e("email",u):u.is('input[type="url"]')?e("url",u):u.is('input[type="range"]')?e("range",u):u.is("select")?u.is("[multiple]")?e("select[multiple]",u):e("select",u):u.is('input[type="file"]')?u.is("[multiple]")?e("file[multiple]",u):e("file",u):u.is('input[type="hidden"]')?e("hidden",u):u.is('input[type="radio"]')?n("radio",u):u.is('input[type="checkbox"]')?n("checkbox",u):e("text",u):(e("button",'input[type="button"], button, input[type="submit"]'),e("text",'input[type="text"]'),e("number",'input[type="number"]'),e("password",'input[type="password"]'),e("email",'input[type="email"]'),e("url",'input[type="url"]'),e("range",'input[type="range"]'),e("textarea","textarea"),e("select","select:not([multiple])"),e("select[multiple]","select[multiple]"),e("file",'input[type="file"]:not([multiple])'),e("file[multiple]",'input[type="file"][multiple]'),e("hidden",'input[type="hidden"]'),n("radio",'input[type="radio"]'),n("checkbox",'input[type="checkbox"]')),r},c.fn.inputVal=function(t){var e=c(this),n=a({$:e});return e.is("input, textarea, select")?void 0===t?n[e.attr("name")].get():(n[e.attr("name")].set(t),e):void 0===t?Q(n,"get"):(j(t,function(t,e){n[e].set(t)}),e)},c.fn.inputOnChange=function(e){var t=c(this),n=a({$:t});return j(n,function(t){t.subscribe("change",function(t){e.call(t.domElement,t.e)})}),t},c.fn.inputDisable=function(){var t=c(this);return Q(a({$:t}),"disable"),t},c.fn.inputEnable=function(){var t=c(this);return Q(a({$:t}),"enable"),t},c.fn.inputClear=function(){var t=c(this);return Q(a({$:t}),"clear"),t},v.fn.repeaterVal=function(){var t,i,r=function(t){if(1===t.length&&(0===t[0].key.length||1===t[0].key.length&&!t[0].key[0]))return t[0].val;j(t,function(t){t.head=t.key.shift()});var e,n,i=(e={},j(t,function(t){e[t.head]||(e[t.head]=[]),e[t.head].push(t)}),e);return/^[0-9]+$/.test(t[0].head)?(n=[],j(i,function(t){n.push(r(t))})):(n={},j(i,function(t,e){n[e]=r(t)})),n};return r((t=v(this).inputVal(),i=[],j(t,function(t,e){var n=[];"undefined"!==e&&(n.push(e.match(/^[^\[]*/)[0]),n=n.concat(O(e.match(/\[[^\]]*\]/g),function(t){return t.replace(/[\[\]]/g,"")})),i.push({val:t,key:n}))}),i))},v.fn.repeater=function(m){var g;return m=m||{},v(this).each(function(){var t=v(this),n=m.show||function(){v(this).show()},e=m.hide||function(t){t()},i=t.find("[data-repeater-list]").first(),o=function(t,n){return t.filter(function(){return!n||0===v(this).closest((t=n,e="selector",O(t,function(t){return t[e]})).join(",")).length;var t,e})},r=function(){return o(i.find("[data-repeater-item]"),m.repeaters)},u=i.find("[data-repeater-item]").first().clone().hide(),a=o(o(v(this).find("[data-repeater-item]"),m.repeaters).first().find("[data-repeater-delete]"),m.repeaters);m.isFirstItemUndeletable&&a&&a.remove();var c=function(){var t=i.data("repeater-list");return m.$parent?m.$parent.data("item-name")+"["+t+"]":t},f=function(t){m.repeaters&&t.each(function(){var e=v(this);j(m.repeaters,function(t){e.find(t.selector).repeater(A(t,{$parent:e}))})})},s=function(t,e,n){t&&j(t,function(t){n.call(e.find(t.selector)[0],t)})},p=function(t,a,c){t.each(function(r){var u=v(this);u.data("item-name",a+"["+r+"]"),o(u.find("[name]"),c).each(function(){var t=v(this),e=t.attr("name").match(/\[[^\]]+\]/g),n=e?q(e).replace(/\[|\]/g,""):t.attr("name"),i=a+"["+r+"]["+n+"]"+(t.is(":checkbox")||t.attr("multiple")?"[]":"");t.attr("name",i),s(c,u,function(t){var e=v(this);p(o(e.find("[data-repeater-item]"),t.repeaters||[]),a+"["+r+"]["+e.find("[data-repeater-list]").first().data("repeater-list")+"]",t.repeaters)})})}),i.find("input[name][checked]").removeAttr("checked").prop("checked",!0)};p(r(),c(),m.repeaters),f(r()),m.initEmpty&&r().remove(),m.ready&&m.ready(function(){p(r(),c(),m.repeaters)});var l,h=(l=function(t,e,n){if(e||m.defaultValues){var i={};o(t.find("[name]"),n).each(function(){var t=v(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];i[t]=v(this).attr("name")}),t.inputVal(O((r=e||m.defaultValues,u=function(t,e){return i[e]},C(r)?(a=[],j(r,function(t,e,n){u(t,e,n)&&a.push(t)})):(a={},j(r,function(t,e,n){u(t,e,n)&&(a[e]=t)})),a),w,function(t){return i[t]}))}var r,u,a;s(n,t,function(i){var r=v(this);o(r.find("[data-repeater-item]"),i.repeaters).each(function(){var t=r.find("[data-repeater-list]").data("repeater-list");if(e&&e[t]){var n=v(this).clone();r.find("[data-repeater-item]").remove(),j(e[t],function(t){var e=n.clone();l(e,t,i.repeaters||[]),r.find("[data-repeater-list]").append(e)})}else l(v(this),i.defaultValues,i.repeaters||[])})})},function(t,e){i.append(t),p(r(),c(),m.repeaters),t.find("[name]").each(function(){v(this).inputClear()}),l(t,e||m.defaultValues,m.repeaters)}),d=function(t){var e=u.clone();h(e,t),m.repeaters&&f(e),n.call(e.get(0))};g=function(t){r().remove(),j(t,d)},o(t.find("[data-repeater-create]"),m.repeaters).click(function(){d()}),i.on("click","[data-repeater-delete]",function(){var t=v(this).closest("[data-repeater-item]").get(0);e.call(t,function(){v(t).remove(),p(r(),c(),m.repeaters)})})}),this.setList=g,this}}(jQuery);
